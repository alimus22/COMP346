Limit  (cost=16296.47..16296.49 rows=10 width=22) (actual time=351.854..351.862 rows=10 loops=1)
  ->  Sort  (cost=16296.47..16321.15 rows=9874 width=22) (actual time=351.853..351.859 rows=10 loops=1)
        Sort Key: (count(a.mid)) DESC
        Sort Method: top-N heapsort  Memory: 25kB
        ->  HashAggregate  (cost=15984.35..16083.09 rows=9874 width=22) (actual time=349.436..350.803 rows=7015 loops=1)
              Group Key: hr.name
              Batches: 1  Memory Usage: 1169kB
              ->  Hash Join  (cost=10955.37..15741.10 rows=48650 width=18) (actual time=282.922..346.054 rows=8052 loops=1)
                    Hash Cond: ((a.name)::text = (hr.name)::text)
                    ->  Seq Scan on actors a  (cost=0.00..4177.37 rows=231737 width=18) (actual time=0.078..23.042 rows=231737 loops=1)
                    ->  Hash  (cost=10831.94..10831.94 rows=9874 width=14) (actual time=282.375..282.380 rows=7015 loops=1)
                          Buckets: 16384  Batches: 1  Memory Usage: 449kB
                          ->  Subquery Scan on hr  (cost=10387.59..10831.94 rows=9874 width=14) (actual time=274.063..280.612 rows=7015 loops=1)
                                Filter: (NOT (hashed SubPlan 1))
                                Rows Removed by Filter: 6695
                                ->  HashAggregate  (cost=3704.25..3901.74 rows=19749 width=14) (actual time=37.097..39.543 rows=13710 loops=1)
                                      Group Key: a_1.name
                                      Batches: 1  Memory Usage: 1553kB
                                      ->  Nested Loop  (cost=0.42..3654.88 rows=19749 width=14) (actual time=0.042..20.332 rows=18031 loops=1)
                                            ->  Seq Scan on movies m  (cost=0.00..208.46 rows=869 width=4) (actual time=0.011..2.280 rows=869 loops=1)
                                                  Filter: (rating >= '4'::double precision)
                                                  Rows Removed by Filter: 9328
                                            ->  Index Only Scan using actors_pkey on actors a_1  (cost=0.42..3.72 rows=25 width=18) (actual time=0.006..0.015 rows=21 loops=869)
                                                  Index Cond: (mid = m.mid)
                                                  Heap Fetches: 0
                                SubPlan 1
                                  ->  HashAggregate  (cost=5625.10..6095.43 rows=47033 width=14) (actual time=182.421..212.073 rows=87031 loops=1)
                                        Group Key: a_2.name
                                        Batches: 5  Memory Usage: 4145kB  Disk Usage: 3352kB
                                        ->  Hash Join  (cost=322.20..5108.14 rows=206784 width=14) (actual time=6.753..99.254 rows=210792 loops=1)
                                              Hash Cond: (a_2.mid = m_1.mid)
                                              ->  Seq Scan on actors a_2  (cost=0.00..4177.37 rows=231737 width=18) (actual time=0.054..29.148 rows=231737 loops=1)
                                              ->  Hash  (cost=208.46..208.46 rows=9099 width=4) (actual time=6.601..6.601 rows=9099 loops=1)
                                                    Buckets: 16384  Batches: 1  Memory Usage: 448kB
                                                    ->  Seq Scan on movies m_1  (cost=0.00..208.46 rows=9099 width=4) (actual time=0.008..2.610 rows=9099 loops=1)
                                                          Filter: (rating < '4'::double precision)
                                                          Rows Removed by Filter: 1098
Planning Time: 2.083 ms
Execution Time: 361.954 ms
